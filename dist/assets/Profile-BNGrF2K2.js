import{j as e,U as R,y as ee,z as te,X as I,M as ae,F as se,I as re,P as le,g as T,G as ne,A as q}from"./ui-Bqq2ZByQ.js";import{r as n}from"./vendor-OvZ-gMQr.js";import{u as de,d as G}from"./index-BZ3NqF2W.js";import{j as ie,k as W,z as oe}from"./firebase-BCjCWirw.js";import{u as ce}from"./router-DzlXm3yj.js";import"./utils-CjxovF-h.js";const ye=()=>{const{user:d,userProfile:xe}=de(),U=ce(),[u,v]=n.useState(!1),[a,C]=n.useState({displayName:"",phoneNumber:"",photoURL:"",mfaEnabled:!1}),[i,k]=n.useState({displayName:"",phoneNumber:"",photoURL:"",mfaEnabled:!1}),[z,B]=n.useState(!0),[f,L]=n.useState(!1),[P,o]=n.useState(""),[M,b]=n.useState(""),[O,p]=n.useState(!1),[y,j]=n.useState(""),[A,N]=n.useState(null),[w,g]=n.useState(!1);n.useEffect(()=>{(async()=>{if(d)try{const l=await ie(W(G,"users",d.uid));if(l.exists()){const s=l.data(),r={displayName:s.displayName||"",phoneNumber:s.phoneNumber||"",photoURL:s.photoURL||"",mfaEnabled:s.mfaEnabled||!1,mfaSecret:s.mfaSecret||""};C(r),k(r)}}catch{o("Failed to load profile data")}finally{B(!1)}})()},[d]);const $=(t,l)=>{const s=Math.floor(Date.now()/3e4);for(let r=-1;r<=1;r++){const x=s+r;if(H(t,x)===l)return!0}return!1},H=(t,l)=>{const s=J(t),r=Math.floor(l),x=new ArrayBuffer(8);new DataView(x).setUint32(4,r,!1);const c=X(s,new Uint8Array(x)),m=c[c.length-1]&15;return(((c[m]&127)<<24|(c[m+1]&255)<<16|(c[m+2]&255)<<8|c[m+3]&255)%1e6).toString().padStart(6,"0")},J=t=>{const l="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let s=0,r=0,x=[];for(let h=0;h<t.length;h++){const c=t[h];if(c==="=")break;const m=l.indexOf(c.toUpperCase());m!==-1&&(r=r<<5|m,s+=5,s>=8&&(x.push(r>>>s-8&255),s-=8))}return new Uint8Array(x)},X=(t,l)=>{const s=new Uint8Array(20);for(let r=0;r<20;r++)s[r]=(t[r%t.length]^l[r%l.length])&255;return s},K=()=>{v(!0),o(""),b(""),g(!1)},Q=()=>{v(!1),k(a),o(""),b(""),g(!1)},Y=async()=>{if(d){if(i.photoURL&&i.photoURL.trim())try{if(!new URL(i.photoURL.trim()).protocol.startsWith("http")){o("Please enter a valid image URL (must start with http:// or https://)");return}}catch{o("Please enter a valid image URL");return}if(a.mfaEnabled&&a.mfaSecret){N(i),p(!0);return}await F(i)}},F=async t=>{L(!0),o(""),b("");try{await oe(W(G,"users",d.uid),{displayName:t.displayName||"",phoneNumber:t.phoneNumber||"",photoURL:t.photoURL||"",updatedAt:new Date}),C(t),v(!1),g(!1),b("Profile updated successfully!")}catch{o("Failed to update profile. Please try again.")}finally{L(!1)}},Z=async()=>{if(!y||y.length!==6){o("Please enter a valid 6-digit MFA code");return}if(!a.mfaSecret||!$(a.mfaSecret,y)){o("Invalid MFA code. Please try again.");return}A&&(await F(A),N(null),p(!1),j(""))},E=(t,l)=>{k(s=>({...s,[t]:l})),t==="photoURL"&&g(!1)},_=()=>{U("/mfa-settings")},D=()=>{U("/dashboard"),setTimeout(()=>{const t=new CustomEvent("setDashboardTab",{detail:"mfa-reset"});window.dispatchEvent(t)},100)},S=()=>{g(!0)},V=()=>{g(!1)};return d?z?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-6 sm:p-8 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full overflow-hidden border-4 border-white/20",children:a.photoURL&&!w?e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-full h-full object-cover",onError:S,onLoad:V}):e.jsx("div",{className:"w-full h-full bg-white/20 flex items-center justify-center",children:e.jsx(R,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white"})})})}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Welcome back!"}),e.jsx("p",{className:"text-blue-100 text-lg",children:a.displayName||d.email})]})]})}),M&&e.jsx("div",{className:"mb-6 bg-green-100 dark:bg-green-900/20 border border-green-400 dark:border-green-600 text-green-700 dark:text-green-400 px-4 py-3 rounded-lg",children:M}),P&&e.jsx("div",{className:"mb-6 bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg",children:P}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-900 dark:text-white",children:"Profile Information"}),u?e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsxs("button",{onClick:Y,disabled:f,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 disabled:opacity-50",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:f?"Saving...":"Save"})]}),e.jsxs("button",{onClick:Q,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs("button",{onClick:K,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Email Address"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 break-all",children:d.email})]})]}),e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Profile Picture"}),u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"url",value:i.photoURL||"",onChange:t=>E("photoURL",t.target.value),placeholder:"Enter image URL (e.g., https://example.com/image.jpg)",className:"w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),i.photoURL&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600",children:w?e.jsx("div",{className:"w-full h-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-gray-400 dark:text-gray-500"})}):e.jsx("img",{src:i.photoURL,alt:"Preview",className:"w-full h-full object-cover",onError:S,onLoad:V})}),e.jsx("div",{className:"text-sm",children:w?e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid image URL"}):e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Preview"})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Enter a direct link to an image (JPG, PNG, GIF). The image should be publicly accessible."})]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[a.photoURL&&!w?e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600",children:e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-full h-full object-cover",onError:S})}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center border border-gray-200 dark:border-gray-600",children:e.jsx(R,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.photoURL?"Custom image set":"No image set"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Display Name"}),u?e.jsx("input",{type:"text",value:i.displayName||"",onChange:t=>E("displayName",t.target.value),placeholder:"Enter your display name",className:"w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.displayName||"Not set"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Phone Number"}),u?e.jsx("input",{type:"tel",value:i.phoneNumber||"",onChange:t=>E("phoneNumber",t.target.value),placeholder:"Enter your phone number",className:"w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.phoneNumber||"Not set"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Multi-Factor Authentication"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-2",children:"Add an extra layer of security to your account"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.mfaEnabled?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:a.mfaEnabled?"Enabled":"Disabled"}),e.jsxs("button",{onClick:_,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Manage MFA"})]}),a.mfaEnabled&&e.jsxs("button",{onClick:D,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 text-sm",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Request Reset"})]})]})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Security"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Email Verified"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d.emailVerified?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300"}`,children:d.emailVerified?"Verified":"Pending"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"MFA Status"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.mfaEnabled?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:a.mfaEnabled?"Enabled":"Disabled"})]})]})]}),a.mfaEnabled&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(q,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-300",children:"MFA Issues?"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1 mb-3",children:"If you've lost access to your authenticator app or device, you can request an MFA reset from administrators."}),e.jsx("button",{onClick:D,className:"text-sm bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition-colors duration-200",children:"Request MFA Reset"})]})]})})]})]})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Verify Changes"}),e.jsx("button",{onClick:()=>{p(!1),j(""),N(null)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors duration-200",children:e.jsx(I,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"MFA Verification Required"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Enter your MFA code to confirm profile changes"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Enter 6-digit code from Google Authenticator"}),e.jsx("input",{type:"text",placeholder:"000000",maxLength:6,value:y,onChange:t=>j(t.target.value.replace(/\D/g,"")),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg font-mono bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:Z,disabled:f,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium disabled:opacity-50",children:f?"Verifying...":"Verify & Save Changes"}),e.jsx("button",{onClick:()=>{p(!1),j(""),N(null)},className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-6 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 font-medium",children:"Cancel"})]})]})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Please log in to view your profile"})})})};export{ye as default};
