import{j as e,b as q,U as _,a0 as Q,e as Z,a1 as ee,a2 as te,E as ae}from"./ui-DBnrXiOs.js";import{r as u}from"./router-us_BkMbn.js";import{u as re,b as P,d as $}from"./index-C1saGSt8.js";import{k as T,b as se,d as ie}from"./firebase-CYC7APn9.js";import"./vendor-BYA32aEE.js";const O=({type:j,placeholder:i,value:l,onChange:w,icon:v,showToggle:N,onToggle:b,showPassword:p,error:h})=>{const[m,M]=u.useState(!1),[C,S]=u.useState({x:0,y:0}),[n,x]=u.useState(!1),g=D=>{const k=D.currentTarget.getBoundingClientRect();S({x:D.clientX-k.left,y:D.clientY-k.top})};return e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:`relative overflow-hidden rounded-lg border transition-all duration-300 ease-in-out ${h?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"} bg-white dark:bg-gray-800`,onMouseMove:g,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:[e.jsx("div",{className:`absolute left-3 top-1/2 -translate-y-1/2 transition-colors duration-200 ${h?"text-red-500 dark:text-red-400":"text-gray-500 dark:text-gray-400 group-focus-within:text-blue-600 dark:group-focus-within:text-blue-400"}`,children:v}),e.jsx("input",{type:j,value:l,onChange:w,onFocus:()=>M(!0),onBlur:()=>M(!1),className:"w-full bg-transparent pl-10 pr-12 py-3 text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:outline-none",placeholder:""}),e.jsx("label",{className:`absolute left-10 transition-all duration-200 ease-in-out pointer-events-none ${m||l?"top-2 text-xs font-medium":"top-1/2 -translate-y-1/2 text-sm"} ${h?"text-red-500 dark:text-red-400":"text-gray-500 dark:text-gray-400"} ${m||l?"text-blue-600 dark:text-blue-400":""}`,children:i}),N&&e.jsx("button",{type:"button",onClick:b,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:p?e.jsx(te,{size:18}):e.jsx(ae,{size:18})}),n&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:`radial-gradient(200px circle at ${C.x}px ${C.y}px, rgba(59, 130, 246, 0.1) 0%, transparent 70%)`}})]}),h&&e.jsx("p",{className:"mt-1 text-sm text-red-500 dark:text-red-400",children:h})]})},ne=()=>{const j=u.useRef(null);return u.useEffect(()=>{const i=j.current;if(!i)return;const l=i.getContext("2d");if(!l)return;const w=()=>{i&&(i.width=window.innerWidth,i.height=window.innerHeight)};w(),window.addEventListener("resize",w);class v{x;y;size;speedX;speedY;opacity;constructor(){if(!i){this.x=0,this.y=0,this.size=1,this.speedX=0,this.speedY=0,this.opacity=0;return}this.x=Math.random()*i.width,this.y=Math.random()*i.height,this.size=Math.random()*2+1,this.speedX=(Math.random()-.5)*.5,this.speedY=(Math.random()-.5)*.5,this.opacity=Math.random()*.3}update(){i&&(this.x+=this.speedX,this.y+=this.speedY,this.x>i.width&&(this.x=0),this.x<0&&(this.x=i.width),this.y>i.height&&(this.y=0),this.y<0&&(this.y=i.height))}draw(){l&&(l.fillStyle=`rgba(59, 130, 246, ${this.opacity})`,l.beginPath(),l.arc(this.x,this.y,this.size,0,Math.PI*2),l.fill())}}const N=[],b=50;for(let h=0;h<b;h++){const m=new v;(m.x!==0||m.y!==0)&&N.push(m)}const p=()=>{!l||!i||(l.clearRect(0,0,i.width,i.height),N.forEach(h=>{h.update(),h.draw()}),requestAnimationFrame(p))};return p(),()=>{window.removeEventListener("resize",w)}},[]),e.jsx("canvas",{ref:j,className:"absolute inset-0 pointer-events-none",style:{zIndex:10}})},he=({onSignUpClick:j,onSuccess:i})=>{const[l,w]=u.useState(""),[v,N]=u.useState(""),[b,p]=u.useState(""),[h,m]=u.useState(!1),[M,C]=u.useState(!1),[S,n]=u.useState(""),[x,g]=u.useState(!1),[D,k]=u.useState(""),[A,z]=u.useState(null),[I,R]=u.useState(!1),{signInWithGoogle:L}=re(),B=(t,s)=>{if(!t||!s||s.length!==6)return!1;const a=Math.floor(Date.now()/3e4);for(let r=-2;r<=2;r++){const d=a+r;if(V(t,d)===s)return!0}return!1},V=(t,s)=>{try{const a=H(t),r=new ArrayBuffer(8);new DataView(r).setUint32(4,s,!1);const o=W(a,new Uint8Array(r)),f=o[o.length-1]&15;return(((o[f]&127)<<24|(o[f+1]&255)<<16|(o[f+2]&255)<<8|o[f+3]&255)%1e6).toString().padStart(6,"0")}catch{return"000000"}},H=t=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let a=0,r=0;const d=[],o=t.replace(/=/g,"").toUpperCase();for(let f=0;f<o.length;f++){const y=o[f],c=s.indexOf(y);c!==-1&&(r=r<<5|c,a+=5,a>=8&&(d.push(r>>>a-8&255),a-=8))}return new Uint8Array(d)},W=(t,s)=>{const r=new Uint8Array(64);if(t.length>64){const c=U(t);r.set(c.slice(0,64))}else r.set(t);const d=new Uint8Array(64),o=new Uint8Array(64);for(let c=0;c<64;c++)d[c]=r[c]^54,o[c]=r[c]^92;const f=U(new Uint8Array([...d,...s]));return U(new Uint8Array([...o,...f]))},U=t=>{const s=new Uint8Array(20);let a=1732584193,r=4023233417,d=2562383102,o=271733878,f=3285377520;for(let c=0;c<t.length;c+=64){const E=t.slice(c,c+64);for(let F=0;F<E.length;F++)a=(a<<5|a>>>27)+E[F]+r,r=d,d=o<<30|o>>>2,o=f,f=a}const y=new DataView(s.buffer);return y.setUint32(0,a,!1),y.setUint32(4,r,!1),y.setUint32(8,d,!1),y.setUint32(12,o,!1),y.setUint32(16,f,!1),s},X=t=>{try{const s=JSON.parse(localStorage.getItem("mfaRememberedDevices")||"{}"),a=`${t}_${navigator.userAgent.slice(0,50)}`,r=s[a];return r&&new Date(r.expires)>new Date?!0:(r&&new Date(r.expires)<=new Date&&(delete s[a],localStorage.setItem("mfaRememberedDevices",JSON.stringify(s))),!1)}catch{return!1}},Y=t=>{try{const s=JSON.parse(localStorage.getItem("mfaRememberedDevices")||"{}"),a=`${t}_${navigator.userAgent.slice(0,50)}`,r=new Date;r.setDate(r.getDate()+30),s[a]={expires:r.toISOString(),created:new Date().toISOString()},localStorage.setItem("mfaRememberedDevices",JSON.stringify(s))}catch{}},G=async t=>{t.preventDefault(),n(""),g(!0);try{if(!P){n("Authentication service is not available."),g(!1);return}const a=(await T(P,l,v)).user;if(!$){n("Database service is not available."),g(!1);return}const r=await se(ie($,"users",a.uid));if(r.exists()){const d=r.data();if(d.mfaEnabled&&d.mfaSecret){if(X(l)){i&&i();return}await P.signOut(),k(d.mfaSecret),z({email:l,password:v,uid:a.uid}),m(!0),g(!1);return}}i&&i()}catch(s){const a=s;a.code==="auth/user-not-found"?n("No account found with this email address."):a.code==="auth/wrong-password"?n("Incorrect password. Please try again."):a.code==="auth/invalid-email"?n("Please enter a valid email address."):a.code==="auth/too-many-requests"?n("Too many failed attempts. Please try again later."):a.code==="auth/invalid-credential"?n("Invalid email or password. Please check your credentials."):n("Failed to sign in. Please check your credentials.")}finally{g(!1)}},J=async t=>{t.preventDefault(),n(""),g(!0);try{if(!b||b.length!==6){n("Please enter a valid 6-digit MFA code"),g(!1);return}if(!D){n("MFA secret not found. Please try logging in again."),g(!1);return}if(!B(D,b)){n("Invalid MFA code. Please check your authenticator app and try again."),g(!1);return}A&&P&&(await T(P,A.email,A.password),M&&Y(A.email),z(null),m(!1),p(""),k(""),i&&i())}catch(s){s.code==="auth/invalid-credential"?(n("Session expired. Please try logging in again."),m(!1),z(null),p(""),k("")):n("Failed to verify MFA code. Please try again.")}finally{g(!1)}},K=async()=>{try{await L(),i&&i()}catch(t){switch(t.code){case"auth/popup-closed-by-user":n("Sign-in was cancelled. Please try again.");break;case"auth/popup-blocked":n("Popup was blocked. Please allow popups and try again.");break;case"auth/account-exists-with-different-credential":n("An account already exists with this email using a different sign-in method.");break;default:n("Failed to sign in with Google. Please try again.")}}};return h?e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center p-4 relative overflow-hidden",children:[e.jsx(ne,{}),e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-300 dark:border-gray-600 rounded-2xl p-8 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full mb-4",children:e.jsx(q,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Enter the 6-digit code from your authenticator app"})]}),S&&e.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg mb-6",role:"alert",children:e.jsx("span",{className:"block text-sm",children:S})}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsx("div",{children:e.jsx("input",{id:"mfaCode",name:"mfaCode",type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,required:!0,autoComplete:"one-time-code",className:"w-full bg-transparent px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-lg font-mono",placeholder:"000000",value:b,onChange:t=>p(t.target.value.replace(/\D/g,"").slice(0,6)),autoFocus:!0})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"rememberDevice",name:"rememberDevice",type:"checkbox",checked:M,onChange:t=>C(t.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800"}),e.jsx("label",{htmlFor:"rememberDevice",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Don't ask on this browser for 30 days"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"submit",disabled:x||b.length!==6,className:"w-full relative group bg-blue-600 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 ease-in-out hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden",children:[e.jsx("span",{className:`transition-opacity duration-200 ${x?"opacity-0":"opacity-100"}`,children:x?"Verifying...":"Verify Code"}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-in-out"})]}),e.jsx("button",{type:"button",onClick:()=>{m(!1),p(""),n(""),z(null),k("")},className:"w-full text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 transition-colors duration-200",children:"Back to login"})]})]})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 relative overflow-hidden",children:e.jsx("div",{className:"relative z-10 w-full max-w-md",children:e.jsxs("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-300 dark:border-gray-600 rounded-2xl p-8 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full mb-4",children:e.jsx(_,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Sign in to continue"})]}),S&&e.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-400 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg mb-6",role:"alert",children:e.jsx("span",{className:"block text-sm",children:S})}),e.jsxs("button",{onClick:K,className:"w-full flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 mb-6",children:[e.jsx(Q,{size:20}),"Sign in with Google"]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"Or continue with"})})]}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsx(O,{type:"email",placeholder:"Email Address",value:l,onChange:t=>w(t.target.value),icon:e.jsx(Z,{size:18})}),e.jsx(O,{type:I?"text":"password",placeholder:"Password",value:v,onChange:t=>N(t.target.value),icon:e.jsx(ee,{size:18}),showToggle:!0,onToggle:()=>R(!I),showPassword:I}),e.jsxs("button",{type:"submit",disabled:x,className:"w-full relative group bg-blue-600 text-white py-3 px-4 rounded-lg font-medium transition-all duration-300 ease-in-out hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden",children:[e.jsx("span",{className:`transition-opacity duration-200 ${x?"opacity-0":"opacity-100"}`,children:x?"Signing in...":"Sign In"}),x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-in-out"})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["New to Akxtral? "," ",e.jsx("button",{onClick:j,className:"text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Create an account"})]})})]})})})};export{he as default};
