import{u as ee,g as _,_ as T}from"./index-C1saGSt8.js";import{j as e,U as L,g as te,f as ae,X as q,e as se,a3 as re,I as le,a4 as ne,b as B,z as de,A as G}from"./ui-DBnrXiOs.js";import{u as ie,r as o}from"./router-us_BkMbn.js";import"./vendor-BYA32aEE.js";import"./firebase-CYC7APn9.js";const ue=()=>{const{user:c}=ee(),U=ie(),[u,v]=o.useState(!1),[a,C]=o.useState({displayName:"",phoneNumber:"",photoURL:"",mfaEnabled:!1}),[x,k]=o.useState({displayName:"",phoneNumber:"",photoURL:"",mfaEnabled:!1}),[O,P]=o.useState(!0),[f,E]=o.useState(!1),[A,m]=o.useState(""),[M,b]=o.useState(""),[z,p]=o.useState(!1),[y,j]=o.useState(""),[D,N]=o.useState(null),[w,h]=o.useState(!1);o.useEffect(()=>{(async()=>{if(c)try{const r=await _();if(!r){P(!1);return}const{doc:l,getDoc:s}=await T(async()=>{const{doc:d,getDoc:n}=await import("./firebase-CYC7APn9.js").then(g=>g.B);return{doc:d,getDoc:n}},[]),i=await s(l(r,"users",c.uid));if(i.exists()){const d=i.data(),n={displayName:d.displayName||"",phoneNumber:d.phoneNumber||"",photoURL:d.photoURL||"",mfaEnabled:d.mfaEnabled||!1,mfaSecret:d.mfaSecret||""};C(n),k(n)}}catch{m("Failed to load profile data")}finally{P(!1)}})()},[c]);const W=(t,r)=>{const l=Math.floor(Date.now()/3e4);for(let s=-1;s<=1;s++){const i=l+s;if($(t,i)===r)return!0}return!1},$=(t,r)=>{const l=H(t),s=Math.floor(r),i=new ArrayBuffer(8);new DataView(i).setUint32(4,s,!1);const n=J(l,new Uint8Array(i)),g=n[n.length-1]&15;return(((n[g]&127)<<24|(n[g+1]&255)<<16|(n[g+2]&255)<<8|n[g+3]&255)%1e6).toString().padStart(6,"0")},H=t=>{const r="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let l=0,s=0,i=[];for(let d=0;d<t.length;d++){const n=t[d];if(n==="=")break;const g=r.indexOf(n.toUpperCase());g!==-1&&(s=s<<5|g,l+=5,l>=8&&(i.push(s>>>l-8&255),l-=8))}return new Uint8Array(i)},J=(t,r)=>{const l=new Uint8Array(20);for(let s=0;s<20;s++)l[s]=(t[s%t.length]^r[s%r.length])&255;return l},X=()=>{v(!0),m(""),b(""),h(!1)},K=()=>{v(!1),k(a),m(""),b(""),h(!1)},Q=async()=>{if(c){if(x.photoURL&&x.photoURL.trim())try{if(!new URL(x.photoURL.trim()).protocol.startsWith("http")){m("Please enter a valid image URL (must start with http:// or https://)");return}}catch{m("Please enter a valid image URL");return}if(a.mfaEnabled&&a.mfaSecret){N(x),p(!0);return}await V(x)}},V=async t=>{E(!0),m(""),b("");try{const r=await _();if(!r){m("Database not available"),E(!1);return}const{doc:l,updateDoc:s}=await T(async()=>{const{doc:i,updateDoc:d}=await import("./firebase-CYC7APn9.js").then(n=>n.B);return{doc:i,updateDoc:d}},[]);await s(l(r,"users",c.uid),{displayName:t.displayName||"",phoneNumber:t.phoneNumber||"",photoURL:t.photoURL||"",updatedAt:new Date}),C(t),v(!1),h(!1),b("Profile updated successfully!")}catch{m("Failed to update profile. Please try again.")}finally{E(!1)}},Y=async()=>{if(!y||y.length!==6){m("Please enter a valid 6-digit MFA code");return}if(!a.mfaSecret||!W(a.mfaSecret,y)){m("Invalid MFA code. Please try again.");return}D&&(await V(D),N(null),p(!1),j(""))},R=(t,r)=>{k(l=>({...l,[t]:r})),t==="photoURL"&&h(!1)},Z=()=>{U("/mfa-settings")},F=()=>{U("/dashboard"),setTimeout(()=>{const t=new CustomEvent("setDashboardTab",{detail:"mfa-reset"});window.dispatchEvent(t)},100)},S=()=>{h(!0)},I=()=>{h(!1)};return c?O?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-6 sm:p-8 mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full overflow-hidden border-4 border-white/20",children:a.photoURL&&!w?e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-full h-full object-cover",onError:S,onLoad:I}):e.jsx("div",{className:"w-full h-full bg-white/20 flex items-center justify-center",children:e.jsx(L,{className:"w-10 h-10 sm:w-12 sm:h-12 text-white"})})})}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Welcome back!"}),e.jsx("p",{className:"text-blue-100 text-lg",children:a.displayName||c.email})]})]})}),M&&e.jsx("div",{className:"mb-6 bg-green-100 dark:bg-green-900/20 border border-green-400 dark:border-green-600 text-green-700 dark:text-green-400 px-4 py-3 rounded-lg",children:M}),A&&e.jsx("div",{className:"mb-6 bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-400 px-4 py-3 rounded-lg",children:A}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-gray-900 dark:text-white",children:"Profile Information"}),u?e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2",children:[e.jsxs("button",{onClick:Q,disabled:f,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 disabled:opacity-50",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:f?"Saving...":"Save"})]}),e.jsxs("button",{onClick:K,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Cancel"})]})]}):e.jsxs("button",{onClick:X,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Email Address"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 break-all",children:c.email})]})]}),e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Profile Picture"}),u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"url",value:x.photoURL||"",onChange:t=>R("photoURL",t.target.value),placeholder:"Enter image URL (e.g., https://example.com/image.jpg)",className:"w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),x.photoURL&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600",children:w?e.jsx("div",{className:"w-full h-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-gray-400 dark:text-gray-500"})}):e.jsx("img",{src:x.photoURL,alt:"Preview",className:"w-full h-full object-cover",onError:S,onLoad:I,loading:"lazy",decoding:"async"})}),e.jsx("div",{className:"text-sm",children:w?e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid image URL"}):e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Preview"})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Enter a direct link to an image (JPG, PNG, GIF). The image should be publicly accessible."})]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[a.photoURL&&!w?e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600",children:e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-full h-full object-cover",onError:S,loading:"lazy",decoding:"async"})}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center border border-gray-200 dark:border-gray-600",children:e.jsx(L,{className:"w-8 h-8 text-gray-400 dark:text-gray-500"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.photoURL?"Custom image set":"No image set"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Display Name"}),u?e.jsx("input",{type:"text",value:x.displayName||"",onChange:t=>R("displayName",t.target.value),placeholder:"Enter your display name",className:"w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.displayName||"Not set"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Phone Number"}),u?e.jsx("input",{type:"tel",value:x.phoneNumber||"",onChange:t=>R("phoneNumber",t.target.value),placeholder:"Enter your phone number",className:"w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.phoneNumber||"Not set"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Multi-Factor Authentication"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-2",children:"Add an extra layer of security to your account"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.mfaEnabled?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:a.mfaEnabled?"Enabled":"Disabled"}),e.jsxs("button",{onClick:Z,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 text-sm",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Manage MFA"})]}),a.mfaEnabled&&e.jsxs("button",{onClick:F,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Request Reset"})]})]})]})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Security"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Email Verified"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c.emailVerified?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300"}`,children:c.emailVerified?"Verified":"Pending"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"MFA Status"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.mfaEnabled?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:a.mfaEnabled?"Enabled":"Disabled"})]})]})]}),a.mfaEnabled&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-300",children:"MFA Issues?"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1 mb-3",children:"If you've lost access to your authenticator app or device, you can request an MFA reset from administrators."}),e.jsx("button",{onClick:F,className:"text-sm bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition-colors duration-200",children:"Request MFA Reset"})]})]})})]})]})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"Verify Changes"}),e.jsx("button",{onClick:()=>{p(!1),j(""),N(null)},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors duration-200",children:e.jsx(q,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(B,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"MFA Verification Required"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Enter your MFA code to confirm profile changes"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Enter 6-digit code from Google Authenticator"}),e.jsx("input",{type:"text",placeholder:"000000",maxLength:6,value:y,onChange:t=>j(t.target.value.replace(/\D/g,"")),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg font-mono bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:Y,disabled:f,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium disabled:opacity-50",children:f?"Verifying...":"Verify & Save Changes"}),e.jsx("button",{onClick:()=>{p(!1),j(""),N(null)},className:"w-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-3 px-6 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200 font-medium",children:"Cancel"})]})]})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Please log in to view your profile"})})})};export{ue as default};
